<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Indian Judicial Analytics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.31.0/build/stlite.css" />
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.31.0/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["pandas", "matplotlib", "seaborn"], 
        entrypoint: "app.py",
        files: {
          "app.py": `
import streamlit as st
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

st.set_page_config(page_title="Indian Courts Analytics", layout="wide")

# --- 1. DATA LOADER ---
@st.cache_data
def load_data():
    # This reads the file you uploaded to GitHub
    try:
        df = pd.read_csv("judgments.csv", low_memory=False)
    except FileNotFoundError:
        st.error("âš ï¸ Error: 'judgments.csv' not found.")
        st.info("Please upload the CSV file to your GitHub repository!")
        st.stop()
        
    # Clean Dates
    # We check for common date column names
    date_col = None
    for col in df.columns:
        if "date" in col.lower():
            date_col = col
            break
            
    if date_col:
        df['parsed_date'] = pd.to_datetime(df[date_col], errors='coerce', dayfirst=True)
        df['Year'] = df['parsed_date'].dt.year
    else:
        st.warning("No date column found. Charts will not show yearly trends.")
        df['Year'] = 2020 # Fallback

    # Clean Bench Names
    if 'bench' in df.columns:
        df['bench'] = df['bench'].astype(str).str.strip()
    
    return df

try:
    with st.spinner("Loading Data... (This happens in your browser)"):
        df = load_data()
except Exception as e:
    st.error(f"An error occurred: {e}")
    st.stop()

# --- 2. SIDEBAR CONTROLS ---
st.sidebar.header("ðŸ” Filter Options")

# Judge Filter
if 'bench' in df.columns:
    all_judges = df['bench'].value_counts().head(50).index.tolist()
    selected_judge = st.sidebar.selectbox("Select Judge:", ["All Judges"] + all_judges)
else:
    selected_judge = "All Judges"

# Year Filter
min_year = int(df['Year'].min()) if not df['Year'].isnull().all() else 2000
max_year = int(df['Year'].max()) if not df['Year'].isnull().all() else 2024
selected_years = st.sidebar.slider("Period:", min_year, max_year, (min_year, max_year))

# --- 3. FILTER LOGIC ---
filtered_df = df[ (df['Year'] >= selected_years[0]) & (df['Year'] <= selected_years[1]) ]

if selected_judge != "All Judges" and 'bench' in df.columns:
    filtered_df = filtered_df[filtered_df['bench'] == selected_judge]

# --- 4. DASHBOARD VISUALS ---
st.title("âš–ï¸ Judicial Analytics Portal")
st.markdown("Running entirely on GitHub Pages (Serverless)")

# Metrics
col1, col2, col3 = st.columns(3)
col1.metric("Total Cases", len(filtered_df))
col2.metric("Active Advocates", filtered_df['pet_adv'].nunique() if 'pet_adv' in df.columns else 0)
col3.metric("Busiest Year", int(filtered_df['Year'].mode()[0]) if not filtered_df.empty else "N/A")

st.divider()

if not filtered_df.empty:
    # Row 1: Trends
    st.subheader("ðŸ“ˆ Case Volume Trend")
    st.line_chart(filtered_df['Year'].value_counts().sort_index())
    
    # Row 2: Analysis
    col_a, col_b = st.columns(2)
    
    with col_a:
        st.subheader("Top Advocates")
        if 'pet_adv' in filtered_df.columns:
            # We create a simple bar chart using Streamlit native charts for speed
            st.bar_chart(filtered_df['pet_adv'].value_counts().head(10))
        else:
            st.write("Advocate data not found.")
            
    with col_b:
        st.subheader("Top Litigants")
        if 'pet' in filtered_df.columns:
            st.bar_chart(filtered_df['pet'].value_counts().head(10))
        else:
            st.write("Petitioner data not found.")

else:
    st.warning("No data found for this selection.")

`,
        },
      }, document.getElementById("root"));
    </script>
  </body>
</html>
