<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Indian Judicial Analytics</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.31.0/build/stlite.css" />
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.31.0/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["pandas", "matplotlib", "seaborn"],
        entrypoint: "app.py",
        files: {
          "app.py": `
import streamlit as st
import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt
from pyodide.http import open_url

st.set_page_config(page_title="Indian Courts Analytics", layout="wide")

# ==========================================
# ðŸ‘‡ PASTE YOUR RAW GITHUB URL BELOW ðŸ‘‡
# ==========================================
DATA_URL = "https://raw.githubusercontent.com/raghav10089/courtanalysis/refs/heads/main/judgments.csv" 

@st.cache_data
def load_data():
    try:
        # We fetch the absolute URL so the browser knows exactly where to find it
        df = pd.read_csv(open_url(DATA_URL), low_memory=False)
        
        # --- CLEANING DATA ---
        # Fix Dates
        date_col = None
        for col in df.columns:
            if "date" in col.lower():
                date_col = col
                break
        
        if date_col:
            df['parsed_date'] = pd.to_datetime(df[date_col], errors='coerce', dayfirst=True)
            df['Year'] = df['parsed_date'].dt.year
        else:
            df['Year'] = 2020

        # Fix Bench Names
        if 'bench' in df.columns:
            df['bench'] = df['bench'].astype(str).str.strip()
            
        return df

    except Exception as e:
        st.error(f"âš ï¸ Error loading data. Please check your URL.")
        st.code(f"URL used: {DATA_URL}")
        st.error(f"Technical Error: {e}")
        st.stop()

# --- APP LOGIC ---
try:
    with st.spinner("Downloading Dataset..."):
        df = load_data()
except Exception as e:
    st.error(f"Critical Error: {e}")
    st.stop()

# --- SIDEBAR ---
st.sidebar.header("ðŸ” Filter Options")
if 'bench' in df.columns:
    all_judges = df['bench'].value_counts().head(50).index.tolist()
    selected_judge = st.sidebar.selectbox("Select Judge:", ["All Judges"] + all_judges)
else:
    selected_judge = "All Judges"

min_year = int(df['Year'].min()) if not df['Year'].isnull().all() else 2000
max_year = int(df['Year'].max()) if not df['Year'].isnull().all() else 2024
selected_years = st.sidebar.slider("Period:", min_year, max_year, (min_year, max_year))

# --- FILTER ---
filtered_df = df[ (df['Year'] >= selected_years[0]) & (df['Year'] <= selected_years[1]) ]
if selected_judge != "All Judges" and 'bench' in df.columns:
    filtered_df = filtered_df[filtered_df['bench'] == selected_judge]

# --- DASHBOARD ---
st.title("âš–ï¸ Judicial Analytics Portal")
col1, col2, col3 = st.columns(3)
col1.metric("Total Cases", len(filtered_df))
col2.metric("Active Advocates", filtered_df['pet_adv'].nunique() if 'pet_adv' in df.columns else 0)
col3.metric("Busiest Year", int(filtered_df['Year'].mode()[0]) if not filtered_df.empty else "N/A")

st.divider()

if not filtered_df.empty:
    st.subheader("ðŸ“ˆ Case Volume Trend")
    st.line_chart(filtered_df['Year'].value_counts().sort_index())
    
    col_a, col_b = st.columns(2)
    with col_a:
        st.subheader("Top Advocates")
        if 'pet_adv' in filtered_df.columns:
            st.bar_chart(filtered_df['pet_adv'].value_counts().head(10))
    with col_b:
        st.subheader("Top Litigants")
        if 'pet' in filtered_df.columns:
            st.bar_chart(filtered_df['pet'].value_counts().head(10))
else:
    st.warning("No data found for this selection.")
`,
        },
      }, document.getElementById("root"));
    </script>
  </body>
</html>
